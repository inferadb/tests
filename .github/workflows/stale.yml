name: Close stale issues and PRs

on:
  schedule:
    - cron: "0 0 * * *"
  workflow_dispatch:

permissions:
  issues: write
  pull-requests: write

jobs:
  stale:
    runs-on: ubuntu-latest
    steps:
      - name: Harden the runner (Audit all outbound calls)
        uses: step-security/harden-runner@df199fb7be9f65074067a9eb93f12bb4c5547cf2 # v2.13.3
        with:
          egress-policy: audit

      - name: Mark stale issues awaiting user response
        uses: actions/stale@997185467fa4f803885201cee163a9f38240193d # v10.1.1
        with:
          only-issue-labels: "status/needs-info"
          stale-issue-label: "stale"
          stale-issue-message: >
            This issue has been marked as stale because we haven't received the
            requested information in 14 days. Please provide the details we asked
            for, or this issue will be closed in another 14 days. If you have
            updates, please comment and we'll remove the stale label.
          close-issue-message: >
            This issue has been closed due to inactivity. If you still experience
            this problem, please open a new issue with the requested information
            and reference this one.
          days-before-issue-stale: 14
          days-before-issue-close: 14
          exempt-issue-labels: "priority/critical,priority/high,status/blocked"
          days-before-pr-stale: -1
          days-before-pr-close: -1

      - name: Mark stale PRs with no activity
        uses: actions/stale@997185467fa4f803885201cee163a9f38240193d # v10.1.1
        with:
          stale-pr-label: "stale"
          stale-pr-message: >
            This pull request has been marked as stale because it has had no
            activity for 60 days. Please update the PR or comment if you're still
            working on this. It will be closed in 30 days if there's no further
            activity.
          close-pr-message: >
            This pull request has been closed due to inactivity. If you'd like to
            continue this work, please open a new PR and reference this one.
          days-before-issue-stale: -1
          days-before-issue-close: -1
          days-before-pr-stale: 60
          days-before-pr-close: 30
          exempt-pr-labels: "priority/critical,priority/high,status/blocked,status/in-progress,status/ready-for-review"
